import { sign } from "../lib/api.js";
import * as output from "../lib/output.js";
export async function signCommand(opts) {
    const request = {
        signatureType: opts.type,
    };
    // Validate and parse input based on signature type
    switch (opts.type) {
        case "personal_sign":
            if (!opts.message) {
                output.error("--message is required for personal_sign");
                process.exit(1);
            }
            request.message = opts.message;
            break;
        case "eth_signTypedData_v4":
            if (!opts.typedData) {
                output.error("--typed-data is required for eth_signTypedData_v4");
                process.exit(1);
            }
            try {
                request.typedData = JSON.parse(opts.typedData);
            }
            catch {
                output.error("--typed-data must be valid JSON");
                process.exit(1);
            }
            break;
        case "eth_signTransaction":
            if (!opts.transaction) {
                output.error("--transaction is required for eth_signTransaction");
                process.exit(1);
            }
            try {
                request.transaction = JSON.parse(opts.transaction);
            }
            catch {
                output.error("--transaction must be valid JSON");
                process.exit(1);
            }
            break;
        default:
            output.error(`Invalid signature type: ${opts.type}. Must be one of: personal_sign, eth_signTypedData_v4, eth_signTransaction`);
            process.exit(1);
    }
    // Execute signing with spinner
    const spinner = output.spinner("Signing...");
    try {
        const result = await sign(request);
        spinner.stop();
        if (!result.success) {
            output.error(result.error || "Signing failed");
            process.exit(1);
        }
        output.success("Signed successfully");
        console.log();
        output.keyValue("Signature", result.signature || "");
        output.keyValue("Signer", result.signer);
        output.keyValue("Type", result.signatureType);
    }
    catch (err) {
        spinner.stop();
        output.error(err.message);
        process.exit(1);
    }
}
//# sourceMappingURL=sign.js.map